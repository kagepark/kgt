####################################
# Copyright (c) CEP Research Institude, All rights reserved. Since 2008
# Kage Park
# License : GPL
####################################

temp() {
  if [ "$KGT_MODE" == "xcat" ]; then
     DSH_TIMEOUT=5
     RSH_STR="xdsh "
  else
     RSH_STR="pdsh "
     shift 1
  fi
  if [ "$KGT_MODE" == "xcat" ]; then
     RSH_HOST=$(echo $(nodels $(echo $* | sed "s/ /,/g") | grep -v "^n0") | sed "s/ /,/g")
  fi

  echo "Physical CPU Temperature unit : *C"
  echo
  printf "%17s %-5s\n" hostname CPU#
  DSH_TIMEOUT=5
  xdsh $RSH_HOST '(
       if [ -f /sys/bus/platform/devices/coretemp.0/hwmon/hwmon*/temp1_input ]; then
          for ii in $(ls -d /sys/bus/platform/devices/coretemp.*); do
             #id=$(($(echo $ii | cut -d . -f2) + 1 ))
             #temp=$([ -f $ii/hwmon/hwmon${id}/temp1_input ] && cat $ii/hwmon/hwmon${id}/temp1_input)
             temp=$([ -f $ii/hwmon/hwmon*/temp1_input ] && cat $ii/hwmon/hwmon*/temp1_input)
             [ -n "$temp" ] && printf "%5.1f " $(bc -l <<< "$temp / 1000")
          done
       else
          echo "Not support this system"
       fi
  )' | sort | while read line; do
      aa=($line)
      printf "%17s " ${aa[0]}
      unset aa[0]
      printf "%-5s\n" "${aa[*]}"
  done
}
