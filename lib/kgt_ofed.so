###################################
# Copyright (c) CEP Research Institude, All rights reserved. Since 2008
# Kage Park
# License : GPL
####################################
_ofed_help() {
       echo "ofed <option>"
       echo " <option>"
       echo "  -fd  : Find device id"
       echo "  -d <device id>  : display <device id> information"
       echo "  -i <image file> : display <image file> information"
       echo "  -backup <backup image path> : It need '-d' option"
       echo "  -b : Burn image to rom, It need '-d' and '-i' option"
       exit
}
ofed() {
   _k_root
   if [ "$#" == "0" ]; then
       _ofed_help
   fi
   fw_file=$(_k_opt -i 1 0 "$@")
   fw_dev=$(_k_opt -d 1 0 "$@")
   if backup_file=$(_k_opt -backup 1 0 "$@"); then
     if [ -f "$backup_file" ]; then
        echo "Already $backup_file exist"
        exit
     fi
     if [ -n "$fw_dev" ]; then
        mstflint -d ${fw_dev} ri $backup_file
     else
        _ofed_help
     fi
   elif _k_opt -fd 0 0 "$@" >/dev/null; then
     lspci -vv | grep -i mella
   elif _k_opt -b 0 0 "$@" >/dev/null; then
     if [ -n "$fw_file" -a -f "$fw_file" -a -n "$fw_dev" ]; then
        mstflint -d $fw_dev -i $fw_file b
     else
        _ofed_help
     fi
   elif [ -n "$fw_file" -a -f "$fw_file" ]; then
     mstflint -i $fw_file q
   elif [ -n "$fw_dev" ]; then
     mstflint -d $fw_dev q
   else
     _ofed_help
   fi
}
